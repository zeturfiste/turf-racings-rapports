      - name: "ðŸ“¥ Sparse clone (scripts + annÃ©es $YEARS)"
        env:
          REPO: ${{ github.repository }}
          TOKEN: ${{ github.token }}
          YEARS: ${{ env.YEARS }}
        run: |
          echo "Clonage sparse du dÃ©pÃ´t $REPO pour annÃ©es: $YEARS"
          echo "RÃ©pertoire courant: $PWD"

          # On part d'un repo vide
          rm -rf .git
          git init .

          # Config remote avec token
          git remote add origin "https://x-access-token:${TOKEN}@github.com/${REPO}.git"

          # Partial clone: ne rÃ©cupÃ¨re pas tous les blobs
          git config remote.origin.promisor true
          git config remote.origin.partialCloneFilter blob:none

          # Active sparse checkout (mode cone)
          git sparse-checkout init --cone

          # Patterns Ã  garder : script, rapport, annÃ©es sÃ©lectionnÃ©es
          PATTERNS="rescrape_courses.py
verification_report.txt"

          for y in $YEARS; do
            PATTERNS="$PATTERNS
resultats-et-rapports/$y"
          done

          printf "%s\n" "$PATTERNS" > .git/info/sparse-checkout

          echo "=== Patterns sparse-checkout ==="
          cat .git/info/sparse-checkout

          # Fetch + checkout seulement ce qui est dans les patterns
          git fetch --depth=1 origin main
          git checkout main

          echo ""
          echo "=== Contenu du repo aprÃ¨s sparse clone ==="
          ls -R .

          echo ""
          echo "=== Espace disque aprÃ¨s sparse clone ==="
          df -h | grep -E "Filesystem|/$"
          echo ""
          du -sh . resultats-et-rapports/* 2>/dev/null || true
